FROM python:3.8-slim

WORKDIR /app

RUN apt-get update && apt-get install -y nginx python3.8-dev && chmod +x run.sh
RUN pip install pipenv

# Install dependencies into their own layer so they are cached between code changes
COPY Pipfile Pipfile.lock ./
RUN pipenv install --system --deploy

COPY . .

ENV DB_PATH=/data/db.sqlite3
ENV DJANGO_SETTINGS_MODULE=settings_prod

EXPOSE 8080

ENTRYPOINT ["./run.sh"]
